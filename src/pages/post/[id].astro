---
import { db } from '../../../lib/db';
import { sanitizeHtml } from '../../../lib/htmlutils'; // optional: write if needed
import { AstroError } from 'astro/errors';

const { id } = Astro.params;

if (!id) throw new AstroError("Post ID not provided", 400);

// Fetch the post from MySQL
const [rows] = await db.query('SELECT * FROM posts WHERE id = ?', [id]);
if (rows.length === 0) throw new AstroError("Post not found", 404);

const post = rows[0];
const htmlContent = post.content; // Already sanitized on creation
---

<article class="content-wrapper">
  <h1 class="post-title">{post.title}</h1>
  <div class="blog-content">
    <div class="post-content" set:html={htmlContent}></div>
  </div>
</article>

<style>
  .content-wrapper {
    background-color: darkslategray;
    color: white;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .blog-content {
    background-color: darkslategray;
    padding: 15px;
    border-radius: 5px;
  }

  .post-title {
    font-size: 24px;
    line-height: 1.6;
  }

  .post-content {
    font-size: 16px;
    line-height: 1.6;
  }

  .post-content * {
    background-color: darkslategray;
    color: white;
    max-width: 100%;
  }

  .post-content pre, 
  .post-content code {
    white-space: pre-wrap;
    word-break: break-word;
    overflow-x: auto;
  }

  .post-content img {
    max-width: 100%;
    height: auto;
  }
</style>
